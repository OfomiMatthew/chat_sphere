{% extends 'base.html' %}

{% block title %}Profile - ChatSphere{% endblock %}

{% block content %}
<div class="min-h-screen bg-splinter-darker p-8">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <a href="{{ url_for('main.index') }}" class="p-3 hover-glow rounded-full border border-splinter-border transition">
                <i class="fas fa-arrow-left text-splinter-green"></i>
            </a>
            <h1 class="text-3xl font-bold splinter-font text-splinter-green glow-text">PROFILE</h1>
            <a href="{{ url_for('auth.logout') }}" class="p-3 bg-red-600 hover:bg-red-700 rounded-full border border-red-500 transition">
                <i class="fas fa-sign-out-alt text-white"></i>
            </a>
        </div>
        
        <!-- Profile Card -->
        <div class="bg-splinter-gray border border-splinter-border rounded-lg p-8 glow-border">
            <!-- Profile Picture -->
            <div class="text-center mb-8">
                <div class="relative inline-block">
                    <img id="profileImage" 
                         src="{{ url_for('static', filename='uploads/profiles/' + current_user.profile_pic) }}"
                         alt="{{ current_user.username }}"
                         class="w-32 h-32 rounded-full border-4 border-splinter-green pulse-glow mx-auto object-cover"
                         onerror="this.src='https://ui-avatars.com/api/?name={{ current_user.username }}&background=00ff41&color=0a0e0f&bold=true&size=200'">
                    <label class="absolute bottom-0 right-0 p-2 bg-splinter-green rounded-full cursor-pointer hover:bg-green-600 transition">
                        <i class="fas fa-camera text-splinter-darker"></i>
                        <input type="file" id="profilePicInput" class="hidden" accept="image/*" onchange="uploadProfilePic(event)">
                    </label>
                </div>
            </div>
            
            <!-- Profile Info -->
            <div class="space-y-6">
                <div>
                    <label class="block text-splinter-green splinter-font text-sm mb-2 uppercase tracking-wider">
                        <i class="fas fa-user mr-2"></i>Username
                    </label>
                    <div class="flex items-center justify-between p-3 bg-splinter-darker border border-splinter-border rounded-lg">
                        <span class="text-gray-100">{{ current_user.username }}</span>
                        <i class="fas fa-lock text-gray-500 text-sm"></i>
                    </div>
                </div>
                
                <div>
                    <label class="block text-splinter-green splinter-font text-sm mb-2 uppercase tracking-wider">
                        <i class="fas fa-envelope mr-2"></i>Email
                    </label>
                    <div class="flex items-center justify-between p-3 bg-splinter-darker border border-splinter-border rounded-lg">
                        <span class="text-gray-100">{{ current_user.email }}</span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-splinter-green splinter-font text-sm mb-2 uppercase tracking-wider">
                        <i class="fas fa-phone mr-2"></i>Phone
                    </label>
                    <div class="flex items-center justify-between p-3 bg-splinter-darker border border-splinter-border rounded-lg">
                        <span class="text-gray-100">{{ current_user.phone or 'Not set' }}</span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-splinter-green splinter-font text-sm mb-2 uppercase tracking-wider">
                        <i class="fas fa-info-circle mr-2"></i>About
                    </label>
                    <div class="relative">
                        <textarea id="aboutText" 
                                  class="w-full px-4 py-3 cyber-input rounded-lg text-gray-100"
                                  rows="3">{{ current_user.about }}</textarea>
                        <button onclick="updateAbout()" 
                                class="absolute bottom-3 right-3 p-2 bg-splinter-green text-splinter-darker rounded-full hover:bg-green-600 transition">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-splinter-green splinter-font text-sm mb-2 uppercase tracking-wider">
                        <i class="fas fa-calendar-alt mr-2"></i>Member Since
                    </label>
                    <div class="p-3 bg-splinter-darker border border-splinter-border rounded-lg">
                        <span class="text-gray-100">{{ current_user.created_at.strftime('%B %d, %Y') }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Statistics -->
            <div class="grid grid-cols-3 gap-4 mt-8 pt-8 border-t border-splinter-border">
                <div class="text-center p-4 bg-splinter-darker rounded-lg border border-splinter-border">
                    <i class="fas fa-comments text-2xl text-splinter-green mb-2"></i>
                    <p class="text-2xl font-bold text-gray-100">{{ current_user.messages_sent.count() }}</p>
                    <p class="text-xs text-gray-400 splinter-font">Messages</p>
                </div>
                <div class="text-center p-4 bg-splinter-darker rounded-lg border border-splinter-border">
                    <i class="fas fa-users text-2xl text-splinter-green mb-2"></i>
                    <p class="text-2xl font-bold text-gray-100">{{ current_user.groups|length }}</p>
                    <p class="text-xs text-gray-400 splinter-font">Groups</p>
                </div>
                <div class="text-center p-4 bg-splinter-darker rounded-lg border border-splinter-border">
                    <i class="fas fa-circle-notch text-2xl text-splinter-green mb-2"></i>
                    <p class="text-2xl font-bold text-gray-100">{{ current_user.statuses.count() }}</p>
                    <p class="text-xs text-gray-400 splinter-font">Statuses</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notification Modal -->
<div id="notificationModal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-50">
    <div class="bg-splinter-gray border-2 border-splinter-green rounded-lg p-6 max-w-sm w-full mx-4 glow-border">
        <h3 class="text-xl font-bold splinter-font text-splinter-green mb-4" id="notificationTitle">Notification</h3>
        <p class="text-gray-300 mb-6" id="notificationMessage"></p>
        <button onclick="closeNotification()" class="w-full py-2 cyber-button rounded-lg text-splinter-green font-semibold">
            OK
        </button>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    function showNotification(message, title = 'Notification') {
        document.getElementById('notificationTitle').textContent = title;
        document.getElementById('notificationMessage').textContent = message;
        document.getElementById('notificationModal').classList.remove('hidden');
        document.getElementById('notificationModal').classList.add('flex');
    }
    
    function closeNotification() {
        document.getElementById('notificationModal').classList.add('hidden');
        document.getElementById('notificationModal').classList.remove('flex');
    }
    
    async function uploadProfilePic(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const formData = new FormData();
        formData.append('file', file);
        
        try {
            const response = await fetch('/media/upload-profile', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                document.getElementById('profileImage').src = data.url + '?t=' + Date.now();
                showNotification('Profile picture updated successfully!', 'Success');
            } else {
                showNotification('Failed to upload profile picture', 'Error');
            }
        } catch (error) {
            console.error('Error uploading profile picture:', error);
            showNotification('Error uploading profile picture', 'Error');
        }
    }
    
    async function updateAbout() {
        const about = document.getElementById('aboutText').value;
        
        // This would need a backend endpoint to update
        showNotification('About updated! (Backend endpoint needed for persistence)', 'Info');
    }
</script>
{% endblock %}
